{% extends "base.html" %}

{% block main_content %}
<!-- Main Content -->
<main class="container my-5 pt-5 form-section">
    <div class="row justify-content-center">
        <div class="col-lg-6 mb-5">
            <h1 class="display-4 mb-4">–ë—Ä–æ–Ω—å –∫–∞–±–∏–Ω–µ—Ç–∞</h1>
            <p class="lead">–í—ã–±–µ—Ä–∏—Ç–µ –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –Ω–∞–∂–º–∏—Ç–µ "–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å"</p>
            <ul class="list-unstyled">
                <li class="mb-3">üéÅ –ö–∞–±–∏–Ω–µ—Ç —Å—Ç–∞–Ω–µ—Ç –∑–∞–Ω—è—Ç –Ω–∞ —ç—Ç–æ –≤—Ä–µ–º—è</li>
                <li class="mb-3">üöÄ –í—ã —Å–º–æ–∂–µ—Ç–µ —É–≤–∏–¥–µ—Ç—å –±—Ä–æ–Ω—å –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏</li>
                <li class="mb-3">üíé –ë—Ä–æ–Ω—å –º–æ–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å</li>
            </ul>
        </div>
        <div class="col-lg-6">
            <div class="card card-dark rounded-4 text-white">
                <div class="card-body p-4">
                    <h2 style="text-align: center;">–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
                    <br>
                    <form method="post">
                        {% if err == 1 %}
                            <p class="warning">–ö–∞–±–∏–Ω–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–≤–æ–±–æ–¥–µ–Ω –∏ –¥–∞—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω–æ–π</p>
                        {% endif %}
                        <div class="mb-4">
                            <input type="date" min="{{today_date}}" max="{{week3_date}}" class="form-control form-control-lg" placeholder="–î–∞—Ç–∞ –±—Ä–æ–Ω–∏" id="date" name="date" required>
                        </div>
                        <div class="mb-4">
                            <select class="form-control form-control-lg" id="cab_num" name="cab_num" required>
                                <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–±–∏–Ω–µ—Ç</option>
                                <option value="20">–ö–∞–±–∏–Ω–µ—Ç 20</option>
                                {% for num in range(22,32) %}
                                <option value="{{ num }}">–ö–∞–±–∏–Ω–µ—Ç {{ num }}</option>
                                {% endfor %}
                                {% for num in range(33,38) %}
                                <option value="{{ num }}">–ö–∞–±–∏–Ω–µ—Ç {{ num }}</option>
                                {% endfor %}
                                {% for num in range(40,42) %}
                                <option value="{{ num }}">–ö–∞–±–∏–Ω–µ—Ç {{ num }}</option>
                                {% endfor %}
                                {% for num in range(44,50) %}
                                <option value="{{ num }}">–ö–∞–±–∏–Ω–µ—Ç {{ num }}</option>
                                {% endfor %}
                                {% for num in range(50,55) %}
                                <option value="{{ num }}">–ö–∞–±–∏–Ω–µ—Ç {{ num }}</option>
                                {% endfor %}
                                {% for num in range(309,315) %}
                                <option value="{{ num }}">–ö–∞–±–∏–Ω–µ—Ç {{ num }}</option>
                                {% endfor %}
                                {% for num in range(410,412) %}
                                <option value="{{ num }}">–ö–∞–±–∏–Ω–µ—Ç {{ num }}</option>
                                {% endfor %}
                                {% for num in range(412,415) %}
                                <option value="{{ num }}">–ö–∞–±–∏–Ω–µ—Ç {{ num }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="mb-4">
                            <select class="form-control form-control-lg" id="cab_num" name="type" required>
                                <option value="" disabled selected>–¢–∏–ø –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</option>
                                <option value="0">–£—Ä–æ–∫</option>
                                <option value="1">–ö—Ä—É–∂–æ–∫</option>
                                <option value="2">–í–Ω–µ–∫–ª–∞—Å—Å–Ω–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å</option>
                            </select>
                        </div>
                        <div class="row">
                            <div class="col-lg-4">
                                <label class="checkbox-container">1 —É—Ä–æ–∫
                                    <input type="checkbox" name="1">
                                    <span class="checkmark"></span>
                                </label>
                                <label class="checkbox-container">2 —É—Ä–æ–∫
                                    <input type="checkbox" name="2">
                                    <span class="checkmark"></span>
                                </label>
                                <label class="checkbox-container">3 —É—Ä–æ–∫
                                    <input type="checkbox" name="3">
                                    <span class="checkmark"></span>
                                </label>
                                <label class="checkbox-container">4 —É—Ä–æ–∫
                                    <input type="checkbox" name="4">
                                    <span class="checkmark"></span>
                                </label>
                                <label class="checkbox-container">5 —É—Ä–æ–∫
                                    <input type="checkbox" name="5">
                                    <span class="checkmark"></span>
                                </label>
                            </div>
                             <div class="col-lg-4">
                                <label class="checkbox-container">6 —É—Ä–æ–∫
                                    <input type="checkbox" name="6">
                                    <span class="checkmark"></span>
                                </label>
                                <label class="checkbox-container">7 —É—Ä–æ–∫
                                    <input type="checkbox" name="7">
                                    <span class="checkmark"></span>
                                </label>
                                <label class="checkbox-container">8 —É—Ä–æ–∫
                                    <input type="checkbox" name="8">
                                    <span class="checkmark"></span>
                                </label>
                                <label class="checkbox-container">9 —É—Ä–æ–∫
                                    <input type="checkbox" name="9">
                                    <span class="checkmark"></span>
                                </label>
                                <label class="checkbox-container">10 —É—Ä–æ–∫
                                    <input type="checkbox" name="10">
                                    <span class="checkmark"></span>
                                </label>
                             </div>
                        </div>
                        <button class="btn btn-purple w-100 mt-3" type="submit">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</main>

<script>
    // –í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ–∫–±–æ–∫—Å–æ–≤
    document.getElementById('registrationForm').addEventListener('submit', function(e) {
        const checkboxes = document.querySelectorAll('.checkbox-container input[type="checkbox"]');
        const isChecked = Array.from(checkboxes).some(c => c.checked);
        
        if (!isChecked) {
            e.preventDefault();
            
            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –æ—à–∏–±–∫–∏
            const existingErrors = document.querySelectorAll('.checkbox-error');
            existingErrors.forEach(error => error.remove());
            
            // –°–æ–∑–¥–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
            const errorDiv = document.createElement('div');
            errorDiv.className = 'checkbox-error';
            errorDiv.innerHTML = `
                <i class="bi bi-exclamation-circle"></i>
                –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –º–∏–Ω–∏–º—É–º 1 —É—Ä–æ–∫!
            `;
            
            // –í—Å—Ç–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –∫–Ω–æ–ø–∫–æ–π
            const submitButton = this.querySelector('button[type="submit"]');
            submitButton.parentNode.insertBefore(errorDiv, submitButton);
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è —á–µ–∫–±–æ–∫—Å–æ–≤
            checkboxes.forEach(checkbox => {
                checkbox.closest('.checkbox-container').classList.add('error-animation');
                setTimeout(() => {
                    checkbox.closest('.checkbox-container').classList.remove('error-animation');
                }, 800);
            });
        }
    });

    // –£–¥–∞–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ
    document.querySelectorAll('.checkbox-container input').forEach(checkbox => {
        checkbox.addEventListener('change', () => {
            const error = document.querySelector('.checkbox-error');
            if (error) error.remove();
        });
    });

    // –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
    const password = document.getElementById('password');
    const confirmPassword = document.getElementById('confirmPassword');
    const form = document.getElementById('registrationForm');
    const passwordError = document.getElementById('passwordError');

    confirmPassword.addEventListener('input', function() {
        if (password.value !== confirmPassword.value) {
            confirmPassword.classList.add('password-mismatch');
            passwordError.style.display = 'block';
        } else {
            confirmPassword.classList.remove('password-mismatch');
            passwordError.style.display = 'none';
        }
    });

    const emailInput = form.querySelector('input[placeholder="Email"]');
    emailInput.addEventListener('input', function() {
        const emailPattern = /^[^\s@]+@(sch2\.ru)$/;
        if (!emailPattern.test(emailInput.value)) {
            emailInput.setCustomValidity("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email");
        } else {
            emailInput.setCustomValidity("");
        }
    });

    password.addEventListener('input', function() {
        if (password.value.length < 8) {
            password.setCustomValidity("–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤");
        } else {
            password.setCustomValidity("");
        }
    });

    document.querySelectorAll('.form-section').forEach((el) => {
        observer.observe(el);
    });
</script>
{% endblock %}
